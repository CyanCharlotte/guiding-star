<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="1768px" preserveAspectRatio="none" style="width:1329px;height:1768px;background:#FFFFFF;" version="1.1" viewBox="0 0 1329 1768" width="1329px" zoomAndPan="magnify"><defs/><g><rect fill="#DDDDDD" height="1756.3359" style="stroke:#181818;stroke-width:0.5;" width="445.5" x="125.5" y="6"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="159" x="268.75" y="18.0669">In The Same Process</text><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="23.5" x2="23.5" y1="101.4297" y2="1756.3359"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="169.5" x2="169.5" y1="101.4297" y2="1756.3359"/><rect fill="#FFFFFF" height="1490.375" style="stroke:#181818;stroke-width:1.0;" width="10" x="164.5" y="205.8281"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="299.5" x2="299.5" y1="101.4297" y2="1756.3359"/><rect fill="#FFFFFF" height="1299.5781" style="stroke:#181818;stroke-width:1.0;" width="10" x="294.5" y="367.4922"/><line style="stroke:#181818;stroke-width:2.0;" x1="290.5" x2="308.5" y1="1658.0703" y2="1676.0703"/><line style="stroke:#181818;stroke-width:2.0;" x1="290.5" x2="308.5" y1="1676.0703" y2="1658.0703"/><rect fill="#FFFFFF" height="746.3203" style="stroke:#181818;stroke-width:1.0;" width="10" x="299.5" y="526.0234"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="527.5" x2="527.5" y1="101.4297" y2="1756.3359"/><rect fill="#FFFFFF" height="947.9844" style="stroke:#181818;stroke-width:1.0;" width="10" x="522.5" y="176.6953"/><rect fill="#FFFFFF" height="18" style="stroke:#181818;stroke-width:1.0;" width="10" x="522.5" y="1738.3359"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="726.5" x2="726.5" y1="101.4297" y2="1756.3359"/><rect fill="#FFFFFF" height="656.9219" style="stroke:#181818;stroke-width:1.0;" width="10" x="721.5" y="483.8906"/><rect fill="#FFFFFF" height="329.3281" style="stroke:#181818;stroke-width:1.0;" width="10" x="726.5" y="795.3516"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="930.5" x2="930.5" y1="101.4297" y2="1756.3359"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="1108.5" x2="1108.5" y1="101.4297" y2="1756.3359"/><rect fill="#FFFFFF" height="947.9844" style="stroke:#181818;stroke-width:1.0;" width="10" x="1103.5" y="176.6953"/><rect fill="#FFFFFF" height="18" style="stroke:#181818;stroke-width:1.0;" width="10" x="1103.5" y="1738.3359"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="31" x="5" y="98.1279">User</text><ellipse cx="23.5" cy="33.6328" fill="#E2E2F0" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M23.5,41.6328 L23.5,68.6328 M10.5,49.6328 L36.5,49.6328 M23.5,68.6328 L10.5,83.6328 M23.5,68.6328 L36.5,83.6328 " fill="none" style="stroke:#181818;stroke-width:0.5;"/><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="80" x="129.5" y="70.1328"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="66" x="136.5" y="90.1279">Endpoint</text><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="67" x="266" y="70.1328"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="53" x="273" y="90.1279">Worker</text><rect fill="#E2E2F0" height="46.5938" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="79" x="488" y="53.8359"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="53" x="501" y="73.8311">Worker</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="65" x="495" y="90.1279">Mainloop</text><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="73" x="690" y="70.1328"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="59" x="697" y="90.1279">Reducer</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="40" x="907.5" y="98.1279">Store</text><path d="M912.5,49.1328 C912.5,39.1328 930.5,39.1328 930.5,39.1328 C930.5,39.1328 948.5,39.1328 948.5,49.1328 L948.5,75.1328 C948.5,85.1328 930.5,85.1328 930.5,85.1328 C930.5,85.1328 912.5,85.1328 912.5,75.1328 L912.5,49.1328 " fill="#E2E2F0" style="stroke:#181818;stroke-width:1.5;"/><path d="M912.5,49.1328 C912.5,59.1328 930.5,59.1328 930.5,59.1328 C930.5,59.1328 948.5,59.1328 948.5,49.1328 " fill="none" style="stroke:#181818;stroke-width:1.5;"/><rect fill="#E2E2F0" height="46.5938" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="74" x="1071.5" y="53.8359"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="42" x="1087.5" y="73.8311">Other</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="60" x="1078.5" y="90.1279">Workers</text><polygon fill="#FEFFDD" points="496,114.4297,559,114.4297,569,125.4297,559,137.4297,496,137.4297,486,125.4297,496,114.4297" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="59" x="498" y="130.4966">state = 1</text><polygon fill="#FEFFDD" points="1077,114.4297,1140,114.4297,1150,125.4297,1140,137.4297,1077,137.4297,1067,125.4297,1077,114.4297" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="59" x="1079" y="130.4966">state = 1</text><polygon fill="#FEFFDD" points="695,114.4297,758,114.4297,768,125.4297,758,137.4297,695,137.4297,685,125.4297,695,114.4297" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="59" x="697" y="130.4966">state = 1</text><line style="stroke:#181818;stroke-width:1.0;" x1="527.5" x2="574.5" y1="163.6953" y2="163.6953"/><line style="stroke:#181818;stroke-width:1.0;" x1="574.5" x2="574.5" y1="163.6953" y2="176.6953"/><line style="stroke:#181818;stroke-width:1.0;" x1="533.5" x2="574.5" y1="176.6953" y2="176.6953"/><polygon fill="#181818" points="543.5,172.6953,533.5,176.6953,543.5,180.6953,539.5,176.6953" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="123" x="539.5" y="158.6294">wait for next event</text><line style="stroke:#181818;stroke-width:1.0;" x1="1108.5" x2="1155.5" y1="163.6953" y2="163.6953"/><line style="stroke:#181818;stroke-width:1.0;" x1="1155.5" x2="1155.5" y1="163.6953" y2="176.6953"/><line style="stroke:#181818;stroke-width:1.0;" x1="1114.5" x2="1155.5" y1="176.6953" y2="176.6953"/><polygon fill="#181818" points="1124.5,172.6953,1114.5,176.6953,1124.5,180.6953,1120.5,176.6953" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="123" x="1120.5" y="158.6294">wait for next event</text><polygon fill="#181818" points="152.5,201.8281,162.5,205.8281,152.5,209.8281,156.5,205.8281" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="23.5" x2="158.5" y1="205.8281" y2="205.8281"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="117" x="30.5" y="200.7622">POST /submit_flag</text><line style="stroke:#181818;stroke-width:1.0;" x1="174.5" x2="216.5" y1="234.9609" y2="234.9609"/><line style="stroke:#181818;stroke-width:1.0;" x1="216.5" x2="216.5" y1="234.9609" y2="247.9609"/><line style="stroke:#181818;stroke-width:1.0;" x1="175.5" x2="216.5" y1="247.9609" y2="247.9609"/><polygon fill="#181818" points="185.5,243.9609,175.5,247.9609,185.5,251.9609,181.5,247.9609" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="111" x="181.5" y="229.895">check permission</text><polygon fill="#FEFFDD" points="121.5,260.9609,217.5,260.9609,227.5,271.9609,217.5,283.9609,121.5,283.9609,111.5,271.9609,121.5,260.9609" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="92" x="123.5" y="277.0278">permission OK</text><polygon fill="#181818" points="287.5,321.3594,297.5,325.3594,287.5,329.3594,291.5,325.3594" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="174.5" x2="293.5" y1="325.3594" y2="325.3594"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="98" x="181.5" y="305.1606">perform_action</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="106" x="181.5" y="320.2935">(SubmitFlagReq)</text><line style="stroke:#181818;stroke-width:1.0;" x1="299.5" x2="346.5" y1="354.4922" y2="354.4922"/><line style="stroke:#181818;stroke-width:1.0;" x1="346.5" x2="346.5" y1="354.4922" y2="367.4922"/><line style="stroke:#181818;stroke-width:1.0;" x1="305.5" x2="346.5" y1="367.4922" y2="367.4922"/><polygon fill="#181818" points="315.5,363.4922,305.5,367.4922,315.5,371.4922,311.5,367.4922" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="145" x="311.5" y="349.4263">await Action(req).call()</text><polygon fill="#181818" points="714.8088,421.926,724.5,426.625,714.2415,429.9058,718.5151,426.1995" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="304.5" x2="724.5" y1="396.625" y2="426.625"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="160" x="311.5" y="391.5591">sock.send_multipart(req)</text><line style="stroke:#181818;stroke-width:1.0;" x1="726.5" x2="773.5" y1="470.8906" y2="470.8906"/><line style="stroke:#181818;stroke-width:1.0;" x1="773.5" x2="773.5" y1="470.8906" y2="483.8906"/><line style="stroke:#181818;stroke-width:1.0;" x1="732.5" x2="773.5" y1="483.8906" y2="483.8906"/><polygon fill="#181818" points="742.5,479.8906,732.5,483.8906,742.5,487.8906,738.5,483.8906" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="75" x="738.5" y="450.6919">@on_action</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="106" x="738.5" y="465.8247">(SubmitFlagReq)</text><line style="stroke:#181818;stroke-width:1.0;" x1="304.5" x2="351.5" y1="513.0234" y2="513.0234"/><line style="stroke:#181818;stroke-width:1.0;" x1="351.5" x2="351.5" y1="513.0234" y2="526.0234"/><line style="stroke:#181818;stroke-width:1.0;" x1="310.5" x2="351.5" y1="526.0234" y2="526.0234"/><polygon fill="#181818" points="320.5,522.0234,310.5,526.0234,320.5,530.0234,316.5,526.0234" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="175" x="316.5" y="507.9575">await sock.recv_multipart()</text><polygon fill="#181818" points="918.5,511.5234,928.5,515.5234,918.5,519.5234,922.5,515.5234" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="731.5" x2="924.5" y1="515.5234" y2="515.5234"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="158" x="738.5" y="510.4575">session.add(submission)</text><polygon fill="#181818" points="918.5,551.1563,928.5,555.1563,918.5,559.1563,922.5,555.1563" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="731.5" x2="924.5" y1="555.1563" y2="555.1563"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="111" x="738.5" y="550.0903">session.commit()</text><polygon fill="#FEFFDD" points="889,568.1563,972,568.1563,982,587.1563,972,606.1563,889,606.1563,879,587.1563,889,568.1563" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="79" x="891" y="584.2231">INSERT INTO</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="72" x="891" y="599.356">submission</text><polygon fill="#181818" points="742.5,628.5547,732.5,632.5547,742.5,636.5547,738.5,632.5547" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="736.5" x2="929.5" y1="632.5547" y2="632.5547"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="73" x="748.5" y="627.4888">row id = 10</text><line style="stroke:#181818;stroke-width:1.0;" x1="731.5" x2="773.5" y1="661.6875" y2="661.6875"/><line style="stroke:#181818;stroke-width:1.0;" x1="773.5" x2="773.5" y1="661.6875" y2="674.6875"/><line style="stroke:#181818;stroke-width:1.0;" x1="732.5" x2="773.5" y1="674.6875" y2="674.6875"/><polygon fill="#181818" points="742.5,670.6875,732.5,674.6875,742.5,678.6875,738.5,674.6875" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="53" x="738.5" y="656.6216">state++</text><polygon fill="#FEFFDD" points="695,687.6875,758,687.6875,768,698.6875,758,710.6875,695,710.6875,685,698.6875,695,687.6875" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="59" x="697" y="703.7544">state = 2</text><line style="stroke:#181818;stroke-width:1.0;" x1="731.5" x2="778.5" y1="782.3516" y2="782.3516"/><line style="stroke:#181818;stroke-width:1.0;" x1="778.5" x2="778.5" y1="782.3516" y2="795.3516"/><line style="stroke:#181818;stroke-width:1.0;" x1="737.5" x2="778.5" y1="795.3516" y2="795.3516"/><polygon fill="#181818" points="747.5,791.3516,737.5,795.3516,747.5,799.3516,743.5,795.3516" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="78" x="743.5" y="731.8872">emit_event(</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="117" x="751.5" y="747.02">NEW_SUBMISSION,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="55" x="751.5" y="762.1528">state=2,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="42" x="751.5" y="777.2856">id=10)</text><polygon fill="#FEFFDD" points="647.5,808.3516,805.5,808.3516,815.5,827.3516,805.5,846.3516,647.5,846.3516,637.5,827.3516,647.5,808.3516" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="154" x="649.5" y="824.4185">event NEW_SUBMISSION</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="96" x="657.5" y="839.5513">state=2, id=10</text><path d="M710.5,855.6172 L982.5,855.6172 L982.5,862.75 L972.5,872.75 L710.5,872.75 L710.5,855.6172 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="190.9297" style="stroke:#000000;stroke-width:1.5;" width="335" x="710.5" y="855.6172"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="227" x="725.5" y="868.6841">@on_event(NEW_SUBMISSION)</text><polygon fill="#181818" points="918.5,915.0156,928.5,919.0156,918.5,923.0156,922.5,919.0156" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="736.5" x2="924.5" y1="919.0156" y2="919.0156"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="140" x="743.5" y="898.8169">sub = load_one_data(</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="136" x="751.5" y="913.9497">SubmissionStore, 10)</text><polygon fill="#FEFFDD" points="846.5,932.0156,1014.5,932.0156,1024.5,951.0156,1014.5,970.0156,846.5,970.0156,836.5,951.0156,846.5,932.0156" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="164" x="848.5" y="948.0825">SELECT FROM submission</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="88" x="856.5" y="963.2153">WHERE id=10</text><polygon fill="#181818" points="747.5,992.4141,737.5,996.4141,747.5,1000.4141,743.5,996.4141" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="741.5" x2="929.5" y1="996.4141" y2="996.4141"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="154" x="753.5" y="991.3481">SubmissionStore(id=10)</text><line style="stroke:#181818;stroke-width:1.0;" x1="736.5" x2="778.5" y1="1025.5469" y2="1025.5469"/><line style="stroke:#181818;stroke-width:1.0;" x1="778.5" x2="778.5" y1="1025.5469" y2="1038.5469"/><line style="stroke:#181818;stroke-width:1.0;" x1="737.5" x2="778.5" y1="1038.5469" y2="1038.5469"/><polygon fill="#181818" points="747.5,1034.5469,737.5,1038.5469,747.5,1042.5469,743.5,1038.5469" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="180" x="743.5" y="1020.481">on_scoreboard_update(sub)</text><polygon fill="#181818" points="1091.8591,1106.8783,1101.5,1111.6797,1091.2074,1114.8517,1095.5199,1111.1909" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="736.5" x2="1101.5" y1="1081.6797" y2="1111.6797"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="82" x="743.5" y="1076.6138">event.send()</text><polygon fill="#181818" points="542.7493,1106.1615,533.5,1111.6797,544.0034,1114.0626,539.4258,1110.7391" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="720.5" x2="532.5" y1="1081.6797" y2="1111.6797"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="82" x="549.5" y="1076.6138">event.send()</text><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="731.5" x2="773.5" y1="1140.8125" y2="1140.8125"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="773.5" x2="773.5" y1="1140.8125" y2="1153.8125"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="726.5" x2="773.5" y1="1153.8125" y2="1153.8125"/><polygon fill="#181818" points="736.5,1149.8125,726.5,1153.8125,736.5,1157.8125,732.5,1153.8125" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="82" x="738.5" y="1135.7466">error = None</text><polygon fill="#181818" points="320.1872,1208.2381,310.5,1212.9453,320.7612,1216.2174,316.4845,1212.5148" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="725.5" x2="309.5" y1="1182.9453" y2="1212.9453"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="160" x="326.5" y="1177.8794">sock.send_multipart(rep)</text><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="309.5" x2="351.5" y1="1272.3438" y2="1272.3438"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="351.5" x2="351.5" y1="1272.3438" y2="1285.3438"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="304.5" x2="351.5" y1="1285.3438" y2="1285.3438"/><polygon fill="#181818" points="314.5,1281.3438,304.5,1285.3438,314.5,1289.3438,310.5,1285.3438" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="109" x="316.5" y="1237.0122">rep = ActionRep(</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="78" x="324.5" y="1252.145">error=None,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="56" x="324.5" y="1267.2778">state=2)</text><polygon fill="#FEFFDD" points="209.5,1298.3438,389.5,1298.3438,399.5,1309.3438,389.5,1321.3438,209.5,1321.3438,199.5,1309.3438,209.5,1298.3438" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="176" x="211.5" y="1314.4106">asyncio.wait_for(state&gt;=2)</text><polygon fill="#FEFFDD" points="448.5,1331.4766,606.5,1331.4766,616.5,1350.4766,606.5,1369.4766,448.5,1369.4766,438.5,1350.4766,448.5,1331.4766" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="154" x="450.5" y="1347.5435">event NEW_SUBMISSION</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="96" x="458.5" y="1362.6763">state=2, id=10</text><polygon fill="#FEFFDD" points="1029.5,1331.4766,1187.5,1331.4766,1197.5,1350.4766,1187.5,1369.4766,1029.5,1369.4766,1019.5,1350.4766,1029.5,1331.4766" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="154" x="1031.5" y="1347.5435">event NEW_SUBMISSION</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="96" x="1039.5" y="1362.6763">state=2, id=10</text><polygon fill="#FEFFDD" points="496,1379.7422,559,1379.7422,569,1390.7422,559,1402.7422,496,1402.7422,486,1390.7422,496,1379.7422" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="59" x="498" y="1395.8091">state = 2</text><polygon fill="#FEFFDD" points="1077,1379.7422,1140,1379.7422,1150,1390.7422,1140,1402.7422,1077,1402.7422,1067,1390.7422,1077,1379.7422" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="59" x="1079" y="1395.8091">state = 2</text><path d="M511.5,1411.875 L783.5,1411.875 L783.5,1419.0078 L773.5,1429.0078 L511.5,1429.0078 L511.5,1411.875 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="190.9297" style="stroke:#000000;stroke-width:1.5;" width="812" x="511.5" y="1411.875"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="227" x="526.5" y="1424.9419">@on_event(NEW_SUBMISSION)</text><polygon fill="#181818" points="941.5,1471.2734,931.5,1475.2734,941.5,1479.2734,937.5,1475.2734" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="935.5" x2="1107.5" y1="1475.2734" y2="1475.2734"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="140" x="947.5" y="1455.0747">sub = load_one_data(</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="136" x="955.5" y="1470.2075">SubmissionStore, 10)</text><polygon fill="#181818" points="918.5,1471.2734,928.5,1475.2734,918.5,1479.2734,922.5,1475.2734" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="527.5" x2="924.5" y1="1475.2734" y2="1475.2734"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="140" x="534.5" y="1455.0747">sub = load_one_data(</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="136" x="542.5" y="1470.2075">SubmissionStore, 10)</text><polygon fill="#FEFFDD" points="846.5,1488.2734,1014.5,1488.2734,1024.5,1507.2734,1014.5,1526.2734,846.5,1526.2734,836.5,1507.2734,846.5,1488.2734" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="164" x="848.5" y="1504.3403">SELECT FROM submission</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="88" x="856.5" y="1519.4731">WHERE id=10</text><polygon fill="#181818" points="1096.5,1548.6719,1106.5,1552.6719,1096.5,1556.6719,1100.5,1552.6719" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="930.5" x2="1102.5" y1="1552.6719" y2="1552.6719"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="154" x="937.5" y="1547.606">SubmissionStore(id=10)</text><polygon fill="#181818" points="538.5,1548.6719,528.5,1552.6719,538.5,1556.6719,534.5,1552.6719" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="532.5" x2="929.5" y1="1552.6719" y2="1552.6719"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="154" x="544.5" y="1547.606">SubmissionStore(id=10)</text><line style="stroke:#181818;stroke-width:1.0;" x1="527.5" x2="569.5" y1="1581.8047" y2="1581.8047"/><line style="stroke:#181818;stroke-width:1.0;" x1="569.5" x2="569.5" y1="1581.8047" y2="1594.8047"/><line style="stroke:#181818;stroke-width:1.0;" x1="528.5" x2="569.5" y1="1594.8047" y2="1594.8047"/><polygon fill="#181818" points="538.5,1590.8047,528.5,1594.8047,538.5,1598.8047,534.5,1594.8047" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="180" x="534.5" y="1576.7388">on_scoreboard_update(sub)</text><line style="stroke:#181818;stroke-width:1.0;" x1="1108.5" x2="1150.5" y1="1581.8047" y2="1581.8047"/><line style="stroke:#181818;stroke-width:1.0;" x1="1150.5" x2="1150.5" y1="1581.8047" y2="1594.8047"/><line style="stroke:#181818;stroke-width:1.0;" x1="1109.5" x2="1150.5" y1="1594.8047" y2="1594.8047"/><polygon fill="#181818" points="1119.5,1590.8047,1109.5,1594.8047,1119.5,1598.8047,1115.5,1594.8047" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="180" x="1115.5" y="1576.7388">on_scoreboard_update(sub)</text><polygon fill="#181818" points="315.5,1633.9375,305.5,1637.9375,315.5,1641.9375,311.5,1637.9375" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="309.5" x2="526.5" y1="1637.9375" y2="1637.9375"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="199" x="321.5" y="1632.8716">state_counter_cond.notify_all()</text><polygon fill="#181818" points="185.5,1663.0703,175.5,1667.0703,185.5,1671.0703,181.5,1667.0703" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="179.5" x2="293.5" y1="1667.0703" y2="1667.0703"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="21" x="191.5" y="1662.0044">rep</text><polygon fill="#181818" points="34.5,1692.2031,24.5,1696.2031,34.5,1700.2031,30.5,1696.2031" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="28.5" x2="163.5" y1="1696.2031" y2="1696.2031"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="74" x="40.5" y="1691.1372">error=None</text><line style="stroke:#181818;stroke-width:1.0;" x1="527.5" x2="574.5" y1="1725.3359" y2="1725.3359"/><line style="stroke:#181818;stroke-width:1.0;" x1="574.5" x2="574.5" y1="1725.3359" y2="1738.3359"/><line style="stroke:#181818;stroke-width:1.0;" x1="533.5" x2="574.5" y1="1738.3359" y2="1738.3359"/><polygon fill="#181818" points="543.5,1734.3359,533.5,1738.3359,543.5,1742.3359,539.5,1738.3359" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="123" x="539.5" y="1720.27">wait for next event</text><line style="stroke:#181818;stroke-width:1.0;" x1="1108.5" x2="1155.5" y1="1725.3359" y2="1725.3359"/><line style="stroke:#181818;stroke-width:1.0;" x1="1155.5" x2="1155.5" y1="1725.3359" y2="1738.3359"/><line style="stroke:#181818;stroke-width:1.0;" x1="1114.5" x2="1155.5" y1="1738.3359" y2="1738.3359"/><polygon fill="#181818" points="1124.5,1734.3359,1114.5,1738.3359,1124.5,1742.3359,1120.5,1738.3359" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="123" x="1120.5" y="1720.27">wait for next event</text><!--MD5=[ca590b59c510f57aa1f3e6d801293c18]
@startuml
!pragma teoz true
hide footbox

actor User as u
box "In The Same Process"
participant Endpoint as e
participant Worker as w
participant "Worker\nMainloop" as m
end box
participant Reducer as r
database Store as s
participant "Other\nWorkers" as ww

hnote over m: state = 1
/ hnote over ww: state = 1
/ hnote over r: state = 1

m -> m ++: wait for next event
& ww -> ww ++: wait for next event

u -> e: POST /submit_flag
activate e

e -> e: check permission

hnote over e: permission OK

e -> w: perform_action\n(SubmitFlagReq)

w -> w ++: await Action(req).call()
w ->(30) r: sock.send_multipart(req)

r -> r ++: @on_action\n(SubmitFlagReq)

w -> w ++: await sock.recv_multipart()
& r -> s: session.add(submission)
r -> s: session.commit()
hnote over s: INSERT INTO\nsubmission
s - -> r: row id = 10
r -> r: state++

hnote over r: state = 2

r -> r ++: emit_event(\n  NEW_SUBMISSION,\n  state=2,\n  id=10)
hnote over r: event NEW_SUBMISSION\n  state=2, id=10

group @on_event(NEW_SUBMISSION)
r -> s: sub = load_one_data(\n  SubmissionStore, 10)
hnote over s: SELECT FROM submission\n  WHERE id=10
s - -> r: SubmissionStore(id=10)
r -> r: on_scoreboard_update(sub)
end

r ->(30) ww: event.send()
& r ->(30) m: event.send()
deactivate r
deactivate m
deactivate ww

r - -> r - -: error = None

r ->(30) w - -: sock.send_multipart(rep)

w - -> w - -: rep = ActionRep(\n  error=None,\n  state=2)

hnote over w: asyncio.wait_for(state>=2)

hnote over m: event NEW_SUBMISSION\n  state=2, id=10
/ hnote over ww: event NEW_SUBMISSION\n  state=2, id=10

hnote over m: state = 2
/ hnote over ww: state = 2

group @on_event(NEW_SUBMISSION)

ww -> s: sub = load_one_data(\n  SubmissionStore, 10)
& m -> s: sub = load_one_data(\n  SubmissionStore, 10)
hnote over s: SELECT FROM submission\n  WHERE id=10
s - -> ww: SubmissionStore(id=10)
& s - -> m: SubmissionStore(id=10)

m -> m: on_scoreboard_update(sub)
& ww -> ww: on_scoreboard_update(sub)

end

m -> w: state_counter_cond.notify_all()

w - -> e: rep
destroy w

e - -> u - -: error=None

m -> m ++: wait for next event
& ww -> ww ++: wait for next event
@enduml

PlantUML version 1.2022.14beta7(Unknown compile time)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>